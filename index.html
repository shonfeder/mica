<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mica Demo</title>
    <style>
        body {
            font-family: Helvectica, sans-serif;
            background-color: white;
            margin: 0;
            padding: 20px;
        }
        select {
            padding: 10px;
            font-size: 16px;
            margin-bottom: 20px;
        }
        pre {
            background-color: #f4f4f4;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .loading {
            color: light blue;
            font-style: italic;
        }
    </style>
</head>
<body>
    <h1>Mica Demo</h1>

    <select id="fileSelect" onchange="displayFiles()">
        <option value="">Select an example module signature</option>
        <!-- TODO: add separate signature file for Sets, Queues, How to Specify It -->
        <option value="case_studies/sets/set_impls.ml">Finite Sets</option>
        <option value="case_studies/regexes/regex_signature.ml">Regex Matcher</option>
        <option value="case_studies/polynomials/polynomial_signature.ml">Polynomials</option>
        <option value="case_studies/maps/map_signature.ml">Persistent Maps</option>
        <option value="case_studies/queues/queue_impls.ml">Ephemeral Queues</option>
        <option value="case_studies/charsets/charsets.ml">Character Sets</option>
        <option value="case_studies/how_to_specify_it/bst.ml"><i>How to Specify It</i> (Hughes '19) Binary Search Trees</option>
        <option value="case_studies/student_submissions/setInterface.ml">Penn CIS 1200 Student Homework Submissions</option>
    </select>

    <h2>Module Signature:</h2>
    <pre id="moduleSig"></pre>

    <h2>Property-based testing code (produced by Mica automatically):</h2>
    <pre id="micaContent"></pre>

    <script>
        async function fetchContent(file) {
            const response = await fetch(`https://raw.githubusercontent.com/ngernest/mica/web/${file}`);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return await response.text();
        }

        async function displayFiles() {
            const select = document.getElementById('fileSelect');
            const moduleSig = document.getElementById('moduleSig');
            const micaContent = document.getElementById('micaContent');
            const selectedFile = select.value;

            if (selectedFile) {
                moduleSig.innerHTML = '<span class="loading">Loading original file...</span>';
                micaContent.innerHTML = '<span class="loading">Loading optimized file...</span>';

                try {
                    const originalFileName = selectedFile;
                    const optimizedFileName = selectedFile.replace('.ml', '_optimized.ml');

                    const [originalFileContent, optimizedFileContent] = await Promise.all([
                        fetchContent(originalFileName),
                        fetchContent(optimizedFileName)
                    ]);

                    moduleSig.textContent = originalFileContent;
                    micaContent.textContent = optimizedFileContent;
                } catch (error) {
                    console.error('Error fetching files:', error);
                    moduleSig.textContent = 'Error loading original file';
                    micaContent.textContent = 'Error loading optimized file';
                }
            } else {
                moduleSig.textContent = '';
                micaContent.textContent = '';
            }
        }
    </script>
</body>
</html>
